<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DeenFlix - ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</title>
  
  <style>
    :root {
      --primary: #00796b; --primary-dark: #004d40; --success: #28a745; --danger: #e74c3c;
      --danger-hover: #c0392b; --info: #007bff; --warning: #ffc107; --bg: #f4f7f6; 
      --white: #ffffff; --gray: #e9ecef; --text-dark: #333; --success-light: #d4edda;
    }
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 1.5rem; background-color: var(--bg); color: var(--text-dark); line-height: 1.6; }
    .container { max-width: 900px; margin: auto; background: var(--white); padding: 1.5rem 2rem; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    h1, h2 { text-align: center; color: var(--primary); margin-bottom: 1.5rem; }
    h1 { font-size: 2.2rem; margin-bottom: 2rem;}
    h2 { font-size: 1.6rem; border-top: 2px solid var(--gray); padding-top: 1.5rem; margin-top: 2.5rem;}
    .form-section { display: flex; flex-direction: column; gap: 1rem; }
    label { font-weight: 600; display: block; margin-bottom: 5px; }
    input[type="text"], input[type="url"], select { padding: 0.7rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 5px; width: 100%; }
    button { background-color: var(--primary); color: white; font-size: 1rem; padding: 0.8rem 1.2rem; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; font-weight: bold; display: block; width: 100%; margin-top: 10px; }
    button:hover { background-color: var(--primary-dark); }
    button:disabled { background-color: #aaa; cursor: not-allowed; }
    textarea { width: 100%; height: 400px; font-family: monospace; font-size: 0.9rem; border: 1px solid #ccc; border-radius: 5px; margin-top: 1rem; padding: 10px; }
    .instructions { background: #e0f2f1; border-left: 5px solid var(--primary); padding: 15px; border-radius: 5px; margin: 1.5rem 0; color: #004d40; }
    .btn-group { display: flex; gap: 10px; justify-content: flex-end; }
    .copy-btn, .download-btn { width: auto; padding: 8px 15px; margin-top: 10px; font-size: 0.9rem; }
    .copy-btn { background: var(--success); }
    .download-btn { background: var(--info); }
    .link-status { font-size: 0.85rem; font-weight: bold; margin-top: 5px; min-height: 18px; }
    .link-status.success { color: var(--success); } .link-status.error { color: var(--danger); } .link-status.loading { color: var(--info); }
    table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
    th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #ddd; vertical-align: middle; }
    th { background-color: #e0f2f1; font-weight: 600; }
    .delete-btn { background-color: var(--danger); padding: 0.5rem 0.8rem; }
    .delete-btn:hover { background-color: var(--danger-hover); }
    .loading-indicator { text-align: center; margin-top: 1rem; font-weight: 500; color: #555; display: none; }
    .results-div { border: 1px solid #ddd; border-radius: 5px; padding: 1rem; margin-top: 1rem; background: #f8f9fa; min-height: 50px; }
    .results-div ul { padding-left: 20px; margin: 0; }
    .results-div .summary { font-weight: bold; color: var(--primary); text-align: center; background: var(--success-light); padding: 10px; border-radius: 5px; margin-top: 10px; }
  </style>
</head>
<body>

  <div class="container">
    <h1>DeenFlix - ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</h1>

    <!-- ‡ßß. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
    <div id="channel-management-section">
      <h2>üì¢ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
      <form id="add-channel-form" class="form-section" style="padding-bottom: 2rem; border-bottom: 2px dashed var(--gray);">
        <div>
          <label for="channel-video-link">‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®:</label>
          <input type="url" id="channel-video-link" placeholder="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶¨‡ßá" required>
        </div>
        <div>
          <label for="new-channel-category">‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</label>
          <select id="new-channel-category" required>
            <option value="">-- ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
            <option value="Waz">Waz</option> <option value="Quran">Quran</option> <option value="Nasheed">Nasheed</option> <option value="Dua">Dua</option>
          </select>
        </div>
        <button type="submit" id="add-channel-btn">‚ûï ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </form>
      <h3 style="text-align: center; margin-top: 2rem;">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡¶æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
      <table id="channels-table">
        <thead><tr><th>‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead>
        <tbody><!-- JS ‡¶¶‡¶ø‡ßü‡ßá ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶Ü‡¶∏‡¶¨‡ßá --></tbody>
      </table>
    </div>
    
    <!-- ‡ß®. ‡¶∏‡¶ø‡¶ô‡ßç‡¶ó‡ßá‡¶≤ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ŸÅÿ±ŸÖ -->
    <form id="single-video-form" class="form-section">
      <h2>‚úçÔ∏è ‡¶∏‡¶ø‡¶ô‡ßç‡¶ó‡ßá‡¶≤ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <div>
        <label for="video-link">‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï</label>
        <input type="url" id="video-link" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®" required>
        <div id="link-status" class="link-status"></div>
      </div>
      <div>
        <label for="video-title">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ (‡¶∏‡ßç‡¶¨‡ßü‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá)</label>
        <input type="text" id="video-title" placeholder="‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶Ü‡¶∏‡¶¨‡ßá" required>
      </div>
      <div>
        <label for="video-category">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</label>
        <select id="video-category" required>
            <option value="">-- ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
            <option value="Waz">Waz</option> <option value="Quran">Quran</option> <option value="Nasheed">Nasheed</option> <option value="Dua">Dua</option>
        </select>
      </div>
      <button type="submit" id="single-video-submit-btn" disabled>‚ûï ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </form>

    <!-- ‡ß©. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
    <div>
      <h2>üîÑ ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ü‡¶®‡ßÅ‡¶®</h2>
      <p style="text-align: center;">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶¨‡ßá‡•§</p>
      <button id="updateAllChannelsBtn">‡¶∏‡¶ï‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ü‡¶®‡ßÅ‡¶®</button>
      <div id="updateAllLoadingIndicator" class="loading-indicator">
           <span>üîÑ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶è‡¶ü‡¶ø ‡¶ï‡ßü‡ßá‡¶ï ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶∏‡¶Æ‡ßü ‡¶®‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</span>
      </div>
      <div id="updateAllResults" class="results-div" style="display:none;"></div>
    </div>
    
    <!-- ‡ß™. ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶π‡¶ì‡ßü‡¶æ ‡¶ï‡ßã‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
    <div id="output-section" style="display:none;">
        <h2>‚úÖ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶π‡¶ì‡ßü‡¶æ ‡¶ï‡ßã‡¶°</h2>
        <div class="instructions">
            <strong>‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ:</strong> ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ "‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá <strong><code>videos.js</code></strong> ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶®‡¶æ‡¶Æ‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶¨‡¶¶‡¶≤‡ßá ‡¶¶‡¶ø‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶ï‡ßã‡¶° ‡¶ï‡¶™‡¶ø‡¶ì ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§
        </div>
        <textarea id="output-code" readonly></textarea>
        <div class="btn-group">
          <button id="copy-btn" class="copy-btn">üìù ‡¶ï‡ßã‡¶° ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <button id="download-btn" class="download-btn">üíæ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
  </div>

  <script src="videos.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
        const YOUTUBE_API_KEYS = [
            "AIzaSyBwpByVQ4gguHCpKlQGeFIF4bBAtBdZu4M", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ï‡ßÄ
            "AIzaSyApHhsojw9ROjKPdNzNVc2K_8DEjSSHR8A", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü ‡¶ï‡ßÄ
            "AIzaSyCV8dc0kI324m_rKYYDHk8MfRZB9XKki4U"  // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡ßÉ‡¶§‡ßÄ‡ßü ‡¶ï‡ßÄ
        ];
        let currentApiKeyIndex = 0;

        const addChannelForm = document.getElementById("add-channel-form");
        const channelsTableBody = document.querySelector("#channels-table tbody");
        const singleVideoForm = document.getElementById("single-video-form");
        const videoLinkInput = document.getElementById("video-link");
        const videoTitleInput = document.getElementById("video-title");
        const singleVideoSubmitBtn = document.getElementById("single-video-submit-btn");
        const linkStatus = document.getElementById("link-status");
        const updateAllChannelsBtn = document.getElementById("updateAllChannelsBtn");
        const updateAllLoadingIndicator = document.getElementById("updateAllLoadingIndicator");
        const updateAllResults = document.getElementById("updateAllResults");
        const outputSection = document.getElementById("output-section");
        const outputCode = document.getElementById("output-code");
        const copyBtn = document.getElementById("copy-btn");
        const downloadBtn = document.getElementById("download-btn");

        let currentVideos = (typeof allVideosData !== 'undefined' && Array.isArray(allVideosData)) ? allVideosData : [];
        let subscribedChannels = [];

        const loadChannels = () => {
            const storedChannels = localStorage.getItem('deenflixSubscribedChannels');
            subscribedChannels = storedChannels ? JSON.parse(storedChannels) : [];
        };
        const saveChannels = () => {
            localStorage.setItem('deenflixSubscribedChannels', JSON.stringify(subscribedChannels));
        };

        const renderChannelsTable = () => {
            channelsTableBody.innerHTML = "";
            if (subscribedChannels.length === 0) {
                channelsTableBody.innerHTML = `<tr><td colspan="3" style="text-align:center;">‡¶ï‡ßã‡¶®‡ßã ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶è‡¶ñ‡¶®‡ßã ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§</td></tr>`;
                return;
            }
            subscribedChannels.forEach(channel => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${channel.channelTitle}</td>
                    <td>${channel.category}</td>
                    <td><button class="delete-btn" data-channel-id="${channel.channelId}">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button></td>
                `;
                channelsTableBody.appendChild(row);
            });
        };

        function displayGeneratedCode() {
            currentVideos.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
            const finalCode = `const allVideosData = ${JSON.stringify(currentVideos, null, 2)};`;
            outputCode.value = finalCode;
            outputSection.style.display = 'block';
        }

        function getYoutubeVideoId(url) {
            try {
                const urlObj = new URL(url);
                if (urlObj.hostname.includes('youtube.com')) return urlObj.searchParams.get('v');
                if (urlObj.hostname.includes('youtu.be')) return urlObj.pathname.substring(1).split('?')[0];
            } catch (e) { console.error("‡¶Ö‡¶¨‡ßà‡¶ß URL:", e); }
            return null;
        }

        function parseDuration(isoDuration) {
            const matches = isoDuration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!matches) return 0;
            const hours = parseInt(matches[1] || 0) * 3600;
            const minutes = parseInt(matches[2] || 0) * 60;
            const seconds = parseInt(matches[3] || 0);
            return hours + minutes + seconds;
        }

        async function fetchWithRetry(baseUrl) {
            for (let i = 0; i < YOUTUBE_API_KEYS.length; i++) {
                const apiKey = YOUTUBE_API_KEYS[currentApiKeyIndex];
                const url = `${baseUrl}&key=${apiKey}`;
                try {
                    const response = await fetch(url);
                    if (response.ok) return await response.json();
                    if (response.status === 403) {
                        console.warn(`API ‡¶ï‡ßÄ #${currentApiKeyIndex + 1} ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`);
                        currentApiKeyIndex = (currentApiKeyIndex + 1) % YOUTUBE_API_KEYS.length;
                    } else { throw new Error(`API Error (${response.status})`); }
                } catch (error) {
                    console.error("Fetch Error:", error);
                    currentApiKeyIndex = (currentApiKeyIndex + 1) % YOUTUBE_API_KEYS.length;
                }
            }
            throw new Error("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ API ‡¶ï‡ßÄ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
        }
        
        addChannelForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('add-channel-btn');
            const videoLink = document.getElementById('channel-video-link').value.trim();
            const category = document.getElementById('new-channel-category').value;
            if (!videoLink || !category) { alert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶¶‡¶ø‡¶®‡•§"); return; }
            btn.disabled = true; btn.textContent = "‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç...";
            try {
                const videoId = getYoutubeVideoId(videoLink);
                if (!videoId) throw new Error("‡¶Ö‡¶¨‡ßà‡¶ß ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≤‡¶ø‡¶Ç‡¶ï‡•§");
                const data = await fetchWithRetry(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}`);
                if (!data.items || data.items.length === 0) throw new Error("‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
                const { channelId, channelTitle } = data.items[0].snippet;
                if (subscribedChannels.some(ch => ch.channelId === channelId)) {
                    alert(`"${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡ßü ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá‡•§`);
                } else {
                    subscribedChannels.push({ channelId, channelTitle, category });
                    saveChannels(); renderChannelsTable();
                    alert(`"${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`);
                }
                addChannelForm.reset();
            } catch (error) {
                alert(`‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá: ${error.message}`);
            } finally {
                btn.disabled = false; btn.textContent = "‚ûï ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®";
            }
        });
        
        channelsTableBody.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const channelIdToDelete = e.target.dataset.channelId;
                if (confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶è‡¶á ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ü‡¶ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                    subscribedChannels = subscribedChannels.filter(ch => ch.channelId !== channelIdToDelete);
                    saveChannels(); renderChannelsTable();
                }
            }
        });

        videoLinkInput.addEventListener('blur', async () => {
            const link = videoLinkInput.value.trim();
            videoTitleInput.value = ""; linkStatus.textContent = "";
            singleVideoSubmitBtn.disabled = true;
            if (!link) return;
            
            const videoId = getYoutubeVideoId(link);
            if (!videoId) {
                linkStatus.textContent = "‡¶Ö‡¶¨‡ßà‡¶ß ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≤‡¶ø‡¶Ç‡¶ï‡•§";
                linkStatus.className = "link-status error";
                return;
            }
            
            if (currentVideos.some(v => getYoutubeVideoId(v.link) === videoId)) {
                linkStatus.textContent = "‡¶è‡¶á ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡ßü ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá‡•§";
                linkStatus.className = "link-status error";
                return;
            }

            linkStatus.textContent = "‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶Ü‡¶®‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."; linkStatus.className = "link-status loading";
            try {
                const data = await fetchWithRetry(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}`);
                if (data && data.items && data.items.length > 0) {
                    videoTitleInput.value = data.items[0].snippet.title;
                    linkStatus.textContent = "‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
                    linkStatus.className = "link-status success";
                    singleVideoSubmitBtn.disabled = false;
                } else { throw new Error("‡¶è‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§"); }
            } catch (error) {
                console.error("Title fetch error:", error);
                linkStatus.textContent = "‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶Ü‡¶®‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§";
                linkStatus.className = "link-status error";
            }
        });
        
        singleVideoForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('video-title').value.trim();
            const link = document.getElementById('video-link').value.trim();
            const category = document.getElementById('video-category').value;
            const videoId = getYoutubeVideoId(link);

            if (!title || !link || !category || !videoId) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return; }
            
            singleVideoSubmitBtn.disabled = true;
            const data = await fetchWithRetry(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}`);
            const videoDetails = data.items[0].snippet;

            const newVideo = { 
                id: Date.now(), 
                title, 
                link, 
                category, 
                publishedAt: videoDetails.publishedAt, 
                channel: videoDetails.channelTitle, // *** ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ***
                channelId: videoDetails.channelId, 
                reactions: { barakallah: 0, subhanallah: 0, ameen: 0 } 
            };
            currentVideos.unshift(newVideo);
            displayGeneratedCode();
            singleVideoForm.reset();
            linkStatus.textContent = "";
            alert('‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßã‡¶° ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        });

        updateAllChannelsBtn.addEventListener("click", async () => {
            if (subscribedChannels.length === 0) {
                alert("‡¶ï‡ßã‡¶®‡ßã ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }
            if (!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ü‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
            
            updateAllLoadingIndicator.style.display = 'block';
            updateAllResults.style.display = 'block';
            updateAllResults.innerHTML = `<ul><li>‡¶™‡ßÅ‡¶∞‡¶®‡ßã ${currentVideos.length} ‡¶ü‡¶ø ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</li><li>‡¶Æ‡ßã‡¶ü ${subscribedChannels.length}‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§</li></ul>`;
            updateAllChannelsBtn.disabled = true;
            outputSection.style.display = 'none';
            let totalNewVideosAdded = 0;
            const existingVideoIds = new Set(currentVideos.map(v => getYoutubeVideoId(v.link)));

            for (let i = 0; i < subscribedChannels.length; i++) {
                const channel = subscribedChannels[i];
                const { channelId, category, channelTitle } = channel;
                updateAllResults.innerHTML += `<ul><li>(${i + 1}/${subscribedChannels.length}) "${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ü‡¶ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</li></ul>`;
                try {
                    const channelData = await fetchWithRetry(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}`);
                    const uploadsPlaylistId = channelData?.items?.[0]?.contentDetails?.relatedPlaylists?.uploads;
                    if (!uploadsPlaylistId) { console.warn(`"${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶™‡ßç‡¶≤‡ßá-‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§`); continue; }
                    
                    const playlistItems = await fetchWithRetry(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${uploadsPlaylistId}&maxResults=50`);
                    if (!playlistItems.items) continue;
                    
                    const videoIds = playlistItems.items.map(item => item.snippet.resourceId.videoId).filter(id => !existingVideoIds.has(id)).join(',');
                    if (!videoIds) {
                       updateAllResults.innerHTML += `<ul><li style="color: #555;">-> "${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶®‡ßá‡¶á‡•§</li></ul>`;
                       continue;
                    }

                    const videosData = await fetchWithRetry(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails,snippet&id=${videoIds}`);
                    let newVideosFromChannel = [];
                    videosData.items.forEach(item => {
                        const duration = parseDuration(item.contentDetails.duration);
                        const isShorts = (item.snippet.title.includes('#shorts') || item.snippet.description.includes('#shorts'));
                        if (duration >= 120 && !isShorts) {
                            newVideosFromChannel.push({ 
                                id: Date.now() + Math.random(), 
                                title: item.snippet.title, 
                                link: `https://www.youtube.com/watch?v=${item.id}`, 
                                category: category, 
                                publishedAt: item.snippet.publishedAt, 
                                channel: item.snippet.channelTitle, // *** ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ***
                                channelId: item.snippet.channelId, 
                                reactions: { barakallah: 0, subhanallah: 0, ameen: 0 } 
                            });
                        }
                    });
                    if (newVideosFromChannel.length > 0) {
                        currentVideos.unshift(...newVideosFromChannel);
                        totalNewVideosAdded += newVideosFromChannel.length;
                        updateAllResults.innerHTML += `<ul><li style="color: green;">-> "${channelTitle}" ‡¶•‡ßá‡¶ï‡ßá ${newVideosFromChannel.length}‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá‡•§</li></ul>`;
                    } else {
                        updateAllResults.innerHTML += `<ul><li style="color: #555;">-> "${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶™‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶®‡ßá‡¶á‡•§</li></ul>`;
                    }
                } catch (channelError) {
                    console.error(`"${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:`, channelError);
                    updateAllResults.innerHTML += `<ul><li style="color: red;">-> "${channelTitle}" ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§</li></ul>`;
                }
            }
            updateAllResults.innerHTML += `<div class="summary">‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡¶Æ‡ßã‡¶ü ${totalNewVideosAdded}‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</div>`;
            displayGeneratedCode();
            updateAllLoadingIndicator.style.display = 'none';
            updateAllChannelsBtn.disabled = false;
        });

        copyBtn.addEventListener('click', () => {
            outputCode.select();
            document.execCommand('copy');
            copyBtn.textContent = '‚úÖ ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!';
            setTimeout(() => { copyBtn.textContent = 'üìù ‡¶ï‡ßã‡¶° ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®'; }, 2000);
        });

        downloadBtn.addEventListener('click', () => {
            const blob = new Blob([outputCode.value], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'videos.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        const initialize = () => { loadChannels(); renderChannelsTable(); };
        initialize();
    });
  </script>

</body>
</html>