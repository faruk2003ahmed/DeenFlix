<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DeenFlix - ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶æ‡¶¨</title>
  
  <style>
    /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶∏‡¶ï‡¶≤ CSS ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
    body{margin:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:#f8f9fa;color:#1c1c1c;transition:background-color .3s,color .3s}body.dark-mode{background-color:#121212;color:#f1f1f1}header{background:linear-gradient(to right,#004d40,#00796b);color:#fff;padding:.8rem 1rem;text-align:center;min-height:45px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:1002}#menu-icon{width:28px;height:28px;cursor:pointer;fill:#fff;display:none;z-index:1001}header h1{margin:0;font-size:1.8rem;font-weight:600;border-right:2px solid rgba(255,255,255,.75);white-space:nowrap;overflow:hidden;animation:blink-caret .75s step-end infinite;position:absolute;left:50%;transform:translateX(-50%)}@keyframes blink-caret{from,to{border-color:transparent}50%{border-color:rgba(255,255,255,.75)}}nav{display:flex;justify-content:center;background:#004d40;padding:.5rem}nav a{color:#fff;margin:.2rem .3rem;text-decoration:none;font-weight:700;font-size:.9rem;padding:.5rem .8rem;border-radius:5px;transition:transform .1s ease-in-out,background-color .2s}nav a:hover{text-decoration:underline}nav a:active{transform:scale(.95);background-color:rgba(255,255,255,.1)}#theme-toggle{cursor:pointer;width:24px;height:24px}#theme-toggle .sun-icon,#theme-toggle .moon-icon{width:100%;height:100%;fill:#fff}.moon-icon{display:none}body.dark-mode .sun-icon{display:none}body.dark-mode .moon-icon{display:block}main{padding:1.5rem; min-height: calc(100vh - 250px);}footer{text-align:center;padding:1.5rem;background-color:#e9ecef;margin-top:2rem}body.dark-mode footer{background-color:#1c1c1c}

    /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ CSS */
    .video-section-container{margin-bottom:2.5rem}.title-container{display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid #00796b;margin-bottom:1.5rem}body.dark-mode .title-container{border-bottom-color:#00a98f}.category-title{font-size:1.8rem;font-weight:700;color:#004d40;padding-bottom:.5rem;margin-bottom:0;border-bottom:none}body.dark-mode .category-title{color:#b2dfdb}#refresh-button{width:28px;height:28px;cursor:pointer;fill:#004d40;transition:transform .3s ease}#refresh-button:hover{transform:rotate(90deg)}body.dark-mode #refresh-button{fill:#b2dfdb}.video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}.video-card{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.1);background-color:#fff;transition:transform .3s,box-shadow .3s}body.dark-mode .video-card{background-color:#2c2c2c;box-shadow:0 4px 12px rgba(0,0,0,.3)}.video-card:hover{transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,.15)}.video-player-container{position:relative;background-color:#000;cursor:pointer}.video-player{width:100%;height:200px;border:none}.interaction-section{padding:.5rem .8rem}.reaction-section{display:flex;justify-content:space-around;align-items:center}.reaction-item{display:flex;flex-direction:column;align-items:center;gap:.2rem;cursor:pointer}.react-btn{background:0 0;border:none;padding:0;font-size:1.2rem;line-height:1;transition:transform .2s ease-in-out,opacity .2s;opacity:.5}.react-btn.reacted{opacity:1;transform:scale(1.2)}.reaction-text{font-weight:600;font-size:.75rem;line-height:1}.reaction-count{font-size:.7rem}.empty-category-message{padding:1rem;text-align:center;background-color:#e0f2f1;border-radius:5px;color:#004d40;grid-column:1 / -1}body.dark-mode .empty-category-message{background-color:#1a3c38;color:#a7c4c1}
    #loading-spinner{text-align:center;padding:1rem;display:none}.spinner{border:4px solid rgba(0,0,0,.1);width:36px;height:36px;border-radius:50%;border-left-color:#00796b;animation:spin 1s ease infinite}@keyframes spin{to{transform:rotate(360deg)}}

    @media (max-width:768px){#menu-icon{display:block}header h1{font-size:1.5rem}nav{position:fixed;top:0;left:0;width:auto;height:100vh;background:#004d40;box-shadow:2px 0 5px rgba(0,0,0,.2);flex-direction:column;justify-content:flex-start;padding:80px 1.5rem 0 1.5rem;transform:translateX(-100%);transition:transform .3s ease-in-out;z-index:1000}nav.nav-open{transform:translateX(0)}nav a{text-align:left;font-size:1rem;white-space:nowrap;width:auto;margin:0 0 10px;padding:.8rem 1.5rem;border-radius:8px;background:rgba(0,0,0,.15);opacity:0;transform:translateY(-15px);transition:opacity .3s ease-out,transform .3s ease-out}nav.nav-open a{opacity:1;transform:translateY(0)}nav.nav-open a:nth-child(1){transition-delay:.15s}nav.nav-open a:nth-child(2){transition-delay:.2s}nav.nav-open a:nth-child(3){transition-delay:.25s}nav.nav-open a:nth-child(4){transition-delay:.3s}nav.nav-open a:nth-child(5){transition-delay:.35s}nav.nav-open a:nth-child(6){transition-delay:.4s}}
  </style>
</head>
<body>
  <header>
    <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6h18v2H3V6z M3,11h18v2H3v-2z M3,16h18v2H3v-2z"/></svg>
    <h1 id="animated-title"></h1>
    <div id="theme-toggle">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7z M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9z M2,12c0,0.55,0.45,1,1,1h1c0.55,0,1-0.45,1-1s-0.45-1-1-1H3C2.45,11,2,11.45,2,12z M19,11h-1c-0.55,0-1,0.45-1,1s0.45,1,1,1h1c0.55,0,1-0.45,1-1S19.55,11,19,11z M11,2v1c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,19v1c0,0.55,0.45,1,1,1s1-0.45,1-1v-1c0-0.55-0.45-1-1-1S11,18.45,11,19z M5.64,4.22c-0.39-0.39-1.02-0.39-1.41,0c-0.39,0.39-0.39,1.02,0,1.41l1.06,1.06c0.39,0.39,1.02,0.39,1.41,0s0.39-1.02,0-1.41L5.64,4.22z M16.97,15.56c-0.39-0.39-1.02-0.39-1.41,0c-0.39,0.39-0.39,1.02,0,1.41l1.06,1.06c0.39,0.39,1.02,0.39,1.41,0s0.39-1.02,0-1.41L16.97,15.56z M4.22,16.97c0.39,0.39,1.02,0.39,1.41,0l1.06-1.06c0.39-0.39,0.39-1.02,0-1.41s-1.02-0.39-1.41,0L4.22,15.56C3.83,15.95,3.83,16.58,4.22,16.97z M18.38,5.64c0.39-0.39,1.02-0.39,1.41,0c0.39,0.39,0.39,1.02,0,1.41l-1.06,1.06c-0.39,0.39-1.02,0.39-1.41,0s-0.39-1.02,0-1.41L18.38,5.64z"/></svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.3,4.84C11.32,4.46,10.22,4.5,9.23,4.9C6.41,6.1,4.94,8.96,5.96,11.77c0.8,2.18,2.89,3.67,5.2,3.84c3.08,0.23,5.83-1.8,6.59-4.6c0.3-1.12,0.1-2.28-0.56-3.26c-0.78-1.17-2.05-1.92-3.41-1.93C13.23,5.85,12.75,5.39,12.3,4.84z"/></svg>
    </div>
  </header>

  <nav id="nav-menu">
    <a href="#" data-category="All">Home</a>
    <a href="#" data-category="Waz">Waz</a>
    <a href="#" data-category="Quran">Quran</a>
    <a href="#" data-category="Nasheed">Nasheed</a>
    <a href="#" data-category="Dua">Dua</a>
    <a href="developer.html">About</a> 
  </nav>

  <main>
    <div class="video-section-container">
      <div class="title-container">
        <h2 id="video-section-title" class="category-title"></h2>
        <svg id="refresh-button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9,14.21,4,12,4c-4.42,0-7.99,3.58-7.99,8s3.57,8,7.99,8c3.73,0,6.84-2.55,7.73-6h-2.08c-0.82,2.33-3.04,4-5.65,4-3.31,0-6-2.69-6-6s2.69-6,6-6c1.66,0,3.14,0.69,4.22,1.78L13,11h7V4L17.65,6.35z"/></svg>
      </div>
      <div id="main-video-grid" class="video-grid"></div>
      <div id="loading-spinner"><div class="spinner"></div></div>
    </div>
  </main>
  
  <footer>
    <p>¬© 2025 DeenFlix. ‡¶∏‡¶∞‡ßç‡¶¨‡¶∏‡ßç‡¶¨‡¶§‡ßç‡¶¨ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§</p>
  </footer>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    const firebaseConfig={apiKey:"AIzaSyBSzGX7miRjrBJAk339LpQDVZ-yfOMnA-E",authDomain:"deenflix-53217.firebaseapp.com",databaseURL:"https://deenflix-53217-default-rtdb.firebaseio.com",projectId:"deenflix-53217",storageBucket:"deenflix-53217.firebasestorage.app",messagingSenderId:"577532998137",appId:"1:577532998137:web:9bb5ac74ce49390cc00d28"};
    if(!firebase.apps.length)firebase.initializeApp(firebaseConfig);
    const db=firebase.database();

    // State Management
    let allVideosData = [], videosToDisplayList = [], players = {}, currentCategory = 'All';
    let videosDisplayedCount = 0, videosPerLoad = 10, isLoading = false;
    
    // DOM Elements
    const mainGrid=document.getElementById('main-video-grid'),sectionTitle=document.getElementById('video-section-title'),navMenu=document.getElementById('nav-menu'),refreshButton=document.getElementById('refresh-button'),loadingSpinner=document.getElementById('loading-spinner');
    
    // Constants
    const categoryInfo={All:'‡¶∏‡¶ï‡¶≤ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì',Waz:'üìñ Waz',Nasheed:'üéµ Nasheed',Quran:'üìò Quran',Dua:'üôè Dua'};
    const reactionTypes=[{key:'barakallah',emoji:'‚ù§Ô∏è',text:'BarakAllah',color:'#e74c3c'},{key:'subhanallah',emoji:'üåü',text:'SubhanAllah',color:'#f39c12'},{key:'ameen',emoji:'üôå',text:'Ameen',color:'#00796b'}];
    
    // Helper Functions
    const getStoredData=(key)=>JSON.parse(localStorage.getItem(key)||'{}');
    const setStoredData=(key,data)=>localStorage.setItem(key,JSON.stringify(data));
    function getVideoId(url){try{if(url.includes("youtube.com/watch")){return new URL(url).searchParams.get("v")}else if(url.includes("youtu.be/")){return new URL(url).pathname.substring(1)}return null}catch(e){return null}}
    function onPlayerStateChange(e){if(e.data===YT.PlayerState.PLAYING){const t=e.target.getIframe().id;for(const o in players)o!==t&&players[o].pauseVideo()}}

    // Reaction Logic
    function handleReaction(video, type, item) {
        const userReactions = getStoredData('userReactions');
        const categoryPrefs = getStoredData('categoryPreferences');
        const currentReaction = userReactions[video.id];
        const reactionSection = item.closest('.reaction-section');

        if (currentReaction === type.key) {
            const btn = item.querySelector('.react-btn');
            const countNode = item.querySelector('.reaction-count');
            let currentCount = parseInt(countNode.textContent.slice(1, -1));
            btn.classList.remove('reacted');
            countNode.textContent = `(${(currentCount > 0 ? currentCount - 1 : 0)})`;
            delete userReactions[video.id];
            categoryPrefs[video.category] = (categoryPrefs[video.category] || 1) - 1;
            db.ref(`videos/${video.id}/reactions/${type.key}`).transaction(c => (c || 1) - 1);
        }
        else {
            if (currentReaction) {
                const oldItem = reactionSection.querySelector(`.reaction-item[data-reactkey="${currentReaction}"]`);
                if (oldItem) {
                    oldItem.querySelector('.react-btn').classList.remove('reacted');
                    const oldCouuntNode = oldItem.querySelector('.reaction-count');
                    let oldCount = parseInt(oldCouuntNode.textContent.slice(1, -1));
                    oldCouuntNode.textContent = `(${(oldCount > 0 ? oldCount - 1 : 0)})`;
                }
                db.ref(`videos/${video.id}/reactions/${currentReaction}`).transaction(c => (c || 1) - 1);
            } else { 
                 categoryPrefs[video.category] = (categoryPrefs[video.category] || 0) + 1;
            }

            const btn = item.querySelector('.react-btn');
            const countNode = item.querySelector('.reaction-count');
            let currentCount = parseInt(countNode.textContent.slice(1, -1));
            btn.classList.add('reacted');
            countNode.textContent = `(${currentCount + 1})`;
            
            userReactions[video.id] = type.key;
            db.ref(`videos/${video.id}/reactions/${type.key}`).transaction(c => (c || 0) + 1);
        }
        setStoredData('userReactions', userReactions);
        setStoredData('categoryPreferences', categoryPrefs);
    }
    
    // Video Card Creation
    function createVideoCard(video){
        const videoId=getVideoId(video.link);
        if(!videoId)return;

        const videoCard=document.createElement('div');
        videoCard.className='video-card';
        videoCard.dataset.videoid=video.id;
        
        const playerContainer=document.createElement('div');
        playerContainer.className='video-player-container';
        const playerDivId=`player-${video.id}`;
        playerContainer.innerHTML=`<div id="${playerDivId}" class="video-player"></div>`;
        
        const interactionSection=document.createElement('div');
        interactionSection.className='interaction-section';

        const reactionSection=document.createElement('div');
        reactionSection.className='reaction-section';
        
        const userReactions=getStoredData('userReactions');
        
        reactionTypes.forEach(type=>{
            const item=document.createElement('div');
            item.className='reaction-item';
            item.dataset.reactkey = type.key;

            const btn=document.createElement('button');
            btn.className='react-btn';
            btn.textContent=type.emoji;
            if(userReactions[video.id]===type.key)btn.classList.add('reacted');
            
            const textNode=document.createElement('div');
            textNode.className='reaction-text';
            textNode.style.color=type.color;
            textNode.textContent=type.text;

            const countNode=document.createElement('div');
            countNode.className='reaction-count';
            const count=(video.reactions&&video.reactions[type.key])||0;
            countNode.textContent=`(${count})`;

            item.append(btn,textNode,countNode);
            item.onclick=()=>handleReaction(video,type,item);
            reactionSection.appendChild(item);
        });

        interactionSection.appendChild(reactionSection);
        videoCard.append(playerContainer,interactionSection);
        mainGrid.appendChild(videoCard);
        
        const player = new YT.Player(playerDivId, {
            height: '200',
            width: '100%',
            videoId: videoId,
            playerVars: {
                rel: 0,
                iv_load_policy: 3,
                modestbranding: 1, // ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ú‡¶®
                autoplay: 0,
                controls: 1
            },
            events: { onStateChange: onPlayerStateChange }
        });

        players[playerDivId] = player;
        playerContainer.addEventListener('click', () => player.playVideo());
    }

    // Infinite Scroll and Display Logic
    function loadMoreVideos() {
        if (isLoading) return;
        isLoading = true;
        loadingSpinner.style.display = 'block';

        const startIndex = videosDisplayedCount;
        const endIndex = startIndex + videosPerLoad;
        const videosToShow = videosToDisplayList.slice(startIndex, endIndex);

        if (videosToShow.length === 0) {
            isLoading = false;
            loadingSpinner.style.display = 'none';
            return;
        }
        
        videosToShow.forEach(video => createVideoCard(video));
        videosDisplayedCount += videosToShow.length;
        
        isLoading = false;
        loadingSpinner.style.display = 'none';
    }
    
    function setupCategoryView(category) {
        currentCategory = category;
        mainGrid.innerHTML = '';
        players = {};
        videosDisplayedCount = 0;
        sectionTitle.innerText = categoryInfo[category] || '‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∏‡¶Æ‡ßÇ‡¶π';

        if(category === 'All'){
            const prefs = getStoredData('categoryPreferences');
            videosToDisplayList = [...allVideosData].map(video => ({ video, score: (prefs[video.category] || 0) + Math.random() })).sort((a, b) => b.score - a.score).map(item => item.video);
        } else {
            videosToDisplayList = allVideosData.filter(v => v.category === category);
        }
        
        if(videosToDisplayList.length === 0) {
             mainGrid.innerHTML='<p class="empty-category-message">‡¶è‡¶á ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
        } else {
            loadMoreVideos();
        }
    }
    
    // Event Listeners
    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
            if (videosDisplayedCount < videosToDisplayList.length) {
                loadMoreVideos();
            }
        }
    });
    
    navMenu.addEventListener('click',e=>{if(e.target.tagName==='A'&&e.target.dataset.category){e.preventDefault();setupCategoryView(e.target.dataset.category);if(navMenu.classList.contains('nav-open')){navMenu.classList.remove('nav-open')}}});
    refreshButton.addEventListener('click',() => setupCategoryView(currentCategory));

    // Firebase Data Loading
    function onYouTubeIframeAPIReady(){
        db.ref("videos").once("value",snapshot=>{
            allVideosData=[];
            if(snapshot.exists()){snapshot.forEach(child=>{allVideosData.push({id:child.key,...child.val()})})}
            setupCategoryView(currentCategory);
        });
    }

    // Other scripts
    const titleElement=document.getElementById("animated-title"),textToType="DeenFlix",typingSpeed=150,eraseSpeed=100,pauseDuration=2e3;let charIndex=0;function type(){charIndex<textToType.length?(titleElement.textContent+=textToType.charAt(charIndex++),setTimeout(type,typingSpeed)):setTimeout(erase,pauseDuration)}function erase(){charIndex>0?(titleElement.textContent=textToType.substring(0,--charIndex),setTimeout(erase,eraseSpeed)):setTimeout(type,typingSpeed)}const themeToggle=document.getElementById("theme-toggle"),body=document.body,savedTheme=localStorage.getItem("theme");"dark"===savedTheme&&body.classList.add("dark-mode"),themeToggle.addEventListener("click",()=>{body.classList.toggle("dark-mode"),localStorage.setItem("theme",body.classList.contains("dark-mode")?"dark":"light")});const menuIcon=document.getElementById("menu-icon");menuIcon.addEventListener("click",()=>{navMenu.classList.toggle("nav-open")}),document.addEventListener("click",function(e){const t=navMenu.contains(e.target),o=menuIcon.contains(e.target);navMenu.classList.contains("nav-open")&&!t&&!o&&navMenu.classList.remove("nav-open")}),document.addEventListener("DOMContentLoaded",type);
  </script>
</body>
</html>
