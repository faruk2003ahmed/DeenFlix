<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DeenFlix - ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶æ‡¶¨</title>
  
  <style>
    /* CSS ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶Ü‡¶õ‡ßá */
    body{margin:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:#f8f9fa;color:#1c1c1c;transition:background-color .3s,color .3s}body.dark-mode{background-color:#121212;color:#f1f1f1}header{background:linear-gradient(to right,#004d40,#00796b);color:#fff;padding:.8rem 1rem;text-align:center;min-height:45px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:1002}#menu-icon{width:28px;height:28px;cursor:pointer;fill:#fff;display:none;z-index:1001}header h1{margin:0;font-size:1.8rem;font-weight:600;border-right:2px solid rgba(255,255,255,.75);white-space:nowrap;overflow:hidden;animation:blink-caret .75s step-end infinite;position:absolute;left:50%;transform:translateX(-50%)}@keyframes blink-caret{from,to{border-color:transparent}50%{border-color:rgba(255,255,255,.75)}}nav{display:flex;justify-content:center;background:#004d40;padding:.5rem}nav a{color:#fff;margin:.2rem .3rem;text-decoration:none;font-weight:700;font-size:.9rem;padding:.5rem .8rem;border-radius:5px;transition:transform .1s ease-in-out,background-color .2s}nav a:hover{text-decoration:underline}nav a:active{transform:scale(.95);background-color:rgba(255,255,255,.1)}#theme-toggle{cursor:pointer;width:24px;height:24px}#theme-toggle .sun-icon,#theme-toggle .moon-icon{width:100%;height:100%;fill:#fff}.moon-icon{display:none}body.dark-mode .sun-icon{display:none}body.dark-mode .moon-icon{display:block}main{padding:1.5rem; min-height: calc(100vh - 250px);}footer{text-align:center;padding:1.5rem;background-color:#e9ecef;margin-top:2rem}body.dark-mode footer{background-color:#1c1c1c}
    .video-section-container{margin-bottom:2.5rem}.title-container{display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid #00796b;margin-bottom:1.5rem}body.dark-mode .title-container{border-bottom-color:#00a98f}.category-title{font-size:1.8rem;font-weight:700;color:#004d40;padding-bottom:.5rem;margin-bottom:0;border-bottom:none}body.dark-mode .category-title{color:#b2dfdb}#refresh-button{width:28px;height:28px;cursor:pointer;fill:#004d40;transition:transform .3s ease}#refresh-button:hover{transform:rotate(90deg)}body.dark-mode #refresh-button{fill:#b2dfdb}
    .video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1.8rem}
    .video-card{border-radius:8px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.1);background-color:#fff;transition:transform .3s,box-shadow .3s;display:flex;flex-direction:column}body.dark-mode .video-card{background-color:#2c2c2c;box-shadow:0 4px 12px rgba(0,0,0,.3)}.video-card:hover:not(.is-loading){transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,.15)}
    .skeleton {background:linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);background-size:200% 100%;animation:skeleton-shine 1.5s linear infinite;border-radius:4px}
    body.dark-mode .skeleton {background:linear-gradient(90deg, #3a3a3a 25%, #444 50%, #3a3a3a 75%);background-size:200% 100%}
    @keyframes skeleton-shine { to { background-position: -200% 0; } }
    .video-card.is-loading .skeleton-image {padding-top:56.25%;width:100%;height:0}
    .video-card.is-loading .skeleton-content {padding:1rem}
    .video-card.is-loading .skeleton-title {height:24px;width:80%;margin-bottom:.5rem}
    .video-card.is-loading .skeleton-subtitle {height:16px;width:60%;margin-bottom:1rem}
    .video-card.is-loading .skeleton-reactions {display:flex;justify-content:space-around}
    .video-card.is-loading .skeleton-circle {width:40px;height:40px;border-radius:50%}
    .video-card .real-content {opacity:0;transition:opacity .4s ease-in-out}
    .video-card:not(.is-loading) .real-content {opacity:1}
    .thumbnail-container {position:relative;background-color:#000;cursor:pointer;width:100%;padding-top:56.25%;height:0}
    .thumbnail-container img {position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;border:none;transition:opacity .2s}
    .thumbnail-container:hover img{opacity:.85}
    .play-button-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:60px;height:60px;background-color:rgba(0,0,0,.6);border-radius:50%;display:flex;align-items:center;justify-content:center;pointer-events:none;transition:background-color .2s,transform .2s}
    .play-button-overlay svg{width:30px;height:30px;fill:#fff}
    .thumbnail-container:hover .play-button-overlay{transform:translate(-50%,-50%) scale(1.1);background-color:rgba(231,76,60,.8)}
    .video-player{position:absolute;top:0;left:0;width:100%;height:100%;border:none}
    .interaction-section{padding:1rem;flex-grow:1;display:flex;flex-direction:column;justify-content:space-between}
    .video-title{font-size:1.1rem;font-weight:600;margin:0 0 1rem 0;line-height:1.4;min-height:46px}
    body.dark-mode .video-title{color:#eee}
    .reaction-section{display:flex;justify-content:space-around;align-items:center}.reaction-item{display:flex;flex-direction:column;align-items:center;gap:.2rem;cursor:pointer}.react-btn{background:0 0;border:none;padding:0;font-size:1.2rem;line-height:1;transition:transform .2s ease-in-out,opacity .2s;opacity:.5}.react-btn.reacted{opacity:1;transform:scale(1.2)}.reaction-text{font-weight:600;font-size:.75rem;line-height:1}.reaction-count{font-size:.7rem}.empty-category-message{padding:1rem;text-align:center;background-color:#e0f2f1;border-radius:5px;color:#004d40;grid-column:1 / -1}body.dark-mode .empty-category-message{background-color:#1a3c38;color:#a7c4c1}
    #loading-spinner{text-align:center;padding:1rem;display:none}
    .spinner{border:4px solid rgba(0,0,0,.1);width:36px;height:36px;border-radius:50%;border-left-color:#00796b;animation:spin 1s ease infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:768px){#menu-icon{display:block}header h1{font-size:1.5rem}nav{position:fixed;top:0;left:0;width:auto;height:100vh;background:#004d40;box-shadow:2px 0 5px rgba(0,0,0,.2);flex-direction:column;justify-content:flex-start;padding:80px 1.5rem 0 1.5rem;transform:translateX(-100%);transition:transform .3s ease-in-out;z-index:1000}nav.nav-open{transform:translateX(0)}nav a{text-align:left;font-size:1rem;white-space:nowrap;width:auto;margin:0 0 10px;padding:.8rem 1.5rem;border-radius:8px;background:rgba(0,0,0,.15);opacity:0;transform:translateY(-15px);transition:opacity .3s ease-out,transform .3s ease-out}nav.nav-open a{opacity:1;transform:translateY(0)}nav.nav-open a:nth-child(1){transition-delay:.15s}nav.nav-open a:nth-child(2){transition-delay:.2s}nav.nav-open a:nth-child(3){transition-delay:.25s}nav.nav-open a:nth-child(4){transition-delay:.3s}nav.nav-open a:nth-child(5){transition-delay:.35s}nav.nav-open a:nth-child(6){transition-delay:.4s}}

    /* ---- ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ---- */
    .video-loading-spinner {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.5);
    }
    .thumbnail-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #e0e0e0;
        color: #333;
        font-size: 0.9rem;
        font-weight: bold;
    }
    body.dark-mode .thumbnail-placeholder {
        background-color: #2c2c2c;
        color: #eee;
    }
    #floating-player-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 320px;
        height: 180px;
        z-index: 2000;
        transform: translateY(250px);
        transition: transform 0.4s ease-in-out;
        background-color: #000;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        border-radius: 8px;
        overflow: hidden;
    }
    #floating-player-container.visible {
        transform: translateY(0);
    }
    #floating-player-content {
        width: 100%;
        height: 100%;
    }
    #floating-player-close {
        position: absolute;
        top: -5px;
        right: 0px;
        background: rgba(0,0,0,0.7);
        color: white;
        border: none;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        font-size: 20px;
        line-height: 24px;
        text-align: center;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.2s;
    }
    #floating-player-close:hover {
        background: #e74c3c;
    }
    /* ---- ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∂‡ßá‡¶∑ ---- */
  </style>
</head>
<body>
  <header>
    <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6h18v2H3V6z M3,11h18v2H3v-2z M3,16h18v2H3v-2z"/></svg><h1 id="animated-title"></h1><div id="theme-toggle"><svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7z M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9z M2,12c0,0.55,0.45,1,1,1h1c0.55,0,1-0.45,1-1s-0.45-1-1-1H3C2.45,11,2,11.45,2,12z M19,11h-1c-0.55,0-1,0.45-1,1s0.45,1,1,1h1c0.55,0,1-0.45,1-1S19.55,11,19,11z M11,2v1c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,19v1c0,0.55,0.45,1,1,1s1-0.45,1-1v-1c0-0.55-0.45-1-1-1S11,18.45,11,19z M5.64,4.22c-0.39-0.39-1.02-0.39-1.41,0c-0.39,0.39-0.39,1.02,0,1.41l1.06,1.06c0.39,0.39,1.02,0.39,1.41,0s0.39-1.02,0-1.41L5.64,4.22z M16.97,15.56c-0.39-0.39-1.02-0.39-1.41,0c-0.39,0.39-0.39,1.02,0,1.41l1.06,1.06c0.39,0.39,1.02,0.39,1.41,0s0.39-1.02,0-1.41L16.97,15.56z M4.22,16.97c0.39,0.39,1.02,0.39,1.41,0l1.06-1.06c0.39-0.39,0.39-1.02,0-1.41s-1.02-0.39-1.41,0L4.22,15.56C3.83,15.95,3.83,16.58,4.22,16.97z M18.38,5.64c0.39-0.39,1.02-0.39,1.41,0c0.39,0.39,0.39,1.02,0,1.41l-1.06,1.06c-0.39,0.39-1.02,0.39-1.41,0s-0.39-1.02,0-1.41L18.38,5.64z"/></svg><svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.3,4.84C11.32,4.46,10.22,4.5,9.23,4.9C6.41,6.1,4.94,8.96,5.96,11.77c0.8,2.18,2.89,3.67,5.2,3.84c3.08,0.23,5.83-1.8,6.59-4.6c0.3-1.12,0.1-2.28-0.56-3.26c-0.78-1.17-2.05-1.92-3.41-1.93C13.23,5.85,12.75,5.39,12.3,4.84z"/></svg></div>
  </header>
  <nav id="nav-menu"><a href="#" data-category="All">Home</a><a href="#" data-category="Waz">Waz</a><a href="#" data-category="Quran">Quran</a><a href="#" data-category="Nasheed">Nasheed</a><a href="#" data-category="Dua">Dua</a><a href="developer.html">About</a></nav>
  <main><div class="video-section-container"><div class="title-container"><h2 id="video-section-title" class="category-title"></h2><svg id="refresh-button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9,14.21,4,12,4c-4.42,0-7.99,3.58-7.99,8s3.57,8,7.99,8c3.73,0,6.84-2.55,7.73-6h-2.08c-0.82,2.33-3.04,4-5.65,4-3.31,0-6-2.69-6-6s2.69-6,6-6c1.66,0,3.14,0.69,4.22,1.78L13,11h7V4L17.65,6.35z"/></svg></div><div id="main-video-grid" class="video-grid"></div><div id="loading-spinner"><div class="spinner"></div></div></div></main>
  <footer><p>¬© 2025 DeenFlix. ‡¶∏‡¶∞‡ßç‡¶¨‡¶∏‡ßç‡¶¨‡¶§‡ßç‡¶¨ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§</p></footer>

  <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶æ‡¶∏‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ -->
  <div id="floating-player-container">
    <div id="floating-player-content"></div>
    <button id="floating-player-close" title="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®">&times;</button>
  </div>
  
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Firebase Config and initial setup
    const firebaseConfig={apiKey:"AIzaSyBSzGX7miRjrBJAk339LpQDVZ-yfOMnA-E",authDomain:"deenflix-53217.firebaseapp.com",databaseURL:"https://deenflix-53217-default-rtdb.firebaseio.com",projectId:"deenflix-53217",storageBucket:"deenflix-53217.firebasestorage.app",messagingSenderId:"577532998137",appId:"1:577532998137:web:9bb5ac74ce49390cc00d28"};if(!firebase.apps.length)firebase.initializeApp(firebaseConfig);const db=firebase.database();let allVideosData=[],videosToDisplayList=[],players={},currentCategory="All",videosDisplayedCount=0,videosPerLoad=10,isLoading=!1;

    // --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ‡¶∂‡ßÅ‡¶∞‡ßÅ ---
    let activePlayer = null; // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶ü‡¶ø ‡¶ö‡¶≤‡¶õ‡ßá ‡¶§‡¶æ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    let originalPlayerContainer = null; // ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶∏‡¶≤ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    const floatingPlayerContainer = document.getElementById('floating-player-container');
    const floatingPlayerContent = document.getElementById('floating-player-content');
    const floatingPlayerCloseBtn = document.getElementById('floating-player-close');
    // --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ‡¶∂‡ßá‡¶∑ ---

    const mainGrid=document.getElementById("main-video-grid"),sectionTitle=document.getElementById("video-section-title"),navMenu=document.getElementById("nav-menu"),refreshButton=document.getElementById("refresh-button"),loadingSpinner=document.getElementById("loading-spinner"),categoryInfo={All:"‡¶∏‡¶ï‡¶≤ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì",Waz:"üìñ Waz",Nasheed:"üéµ Nasheed",Quran:"üìò Quran",Dua:"üôè Dua"},reactionTypes=[{key:"barakallah",emoji:"‚ù§Ô∏è",text:"BarakAllah",color:"#e74c3c"},{key:"subhanallah",emoji:"üåü",text:"SubhanAllah",color:"#f39c12"},{key:"ameen",emoji:"üôå",text:"Ameen",color:"#00796b"}];const getStoredData=e=>JSON.parse(localStorage.getItem(e)||"{}"),setStoredData=(e,t)=>localStorage.setItem(e,JSON.stringify(t));function getVideoId(e){try{return e.includes("youtube.com/watch")?new URL(e).searchParams.get("v"):e.includes("youtu.be/")?new URL(e).pathname.substring(1):null}catch(t){return null}}

    // --- onPlayerStateChange ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá ---
    function onPlayerStateChange(e){
        const playerIframe = e.target.getIframe();
        if(e.data===YT.PlayerState.PLAYING){
            if (activePlayer && activePlayer !== e.target) {
                cleanUpCurrentPlayer(); 
            }
            activePlayer = e.target;
            originalPlayerContainer = playerIframe.parentElement;
            for(const o in players) {
                if(players[o] !== activePlayer && typeof players[o].getPlayerState === 'function' && players[o].getPlayerState() === YT.PlayerState.PLAYING) {
                    players[o].pauseVideo();
                }
            }
        }
        if (e.data === YT.PlayerState.ENDED || e.data === YT.PlayerState.PAUSED) {
            if (e.target === activePlayer && floatingPlayerContainer.classList.contains('visible')) {
                cleanUpCurrentPlayer();
            }
        }
    }

    function handleReaction(e,t,o){const a=getStoredData("userReactions"),n=getStoredData("categoryPreferences"),r=a[e.id],i=o.closest(".reaction-section");if(r===t.key){const l=o.querySelector(".react-btn"),c=o.querySelector(".reaction-count"),s=parseInt(c.textContent.slice(1,-1));l.classList.remove("reacted"),c.textContent=`(${(s>0?s-1:0)})`,delete a[e.id],n[e.category]=(n[e.category]||1)-1,db.ref(`videos/${e.id}/reactions/${t.key}`).transaction(e=>(e||1)-1)}else{if(r){const d=i.querySelector(`.reaction-item[data-reactkey="${r}"]`);if(d){d.querySelector(".react-btn").classList.remove("reacted");const u=d.querySelector(".reaction-count");let m=parseInt(u.textContent.slice(1,-1));u.textContent=`(${(m>0?m-1:0)})`}db.ref(`videos/${e.id}/reactions/${r}`).transaction(e=>(e||1)-1)}else n[e.category]=(n[e.category]||0)+1;const p=o.querySelector(".react-btn"),g=o.querySelector(".reaction-count"),h=parseInt(g.textContent.slice(1,-1));p.classList.add("reacted"),g.textContent=`(${h+1})`,a[e.id]=t.key,db.ref(`videos/${e.id}/reactions/${t.key}`).transaction(e=>(e||0)+1)}setStoredData("userReactions",a),setStoredData("categoryPreferences",n)}

    // --- createVideoCard ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá ---
    async function createVideoCard(video) {
        const videoId = getVideoId(video.link); if (!videoId) return;
        const videoCard = document.createElement('div'); videoCard.className = 'video-card is-loading'; videoCard.dataset.videoid = video.id;
        videoCard.innerHTML = `<div class="skeleton skeleton-image"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-subtitle"></div><div class="skeleton-reactions"><div class="skeleton skeleton-circle"></div><div class="skeleton skeleton-circle"></div><div class="skeleton skeleton-circle"></div></div></div>`;
        mainGrid.appendChild(videoCard);
        
        const imageLoadPromise = new Promise((resolve, reject) => { const img = new Image(); img.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`; img.onload = () => resolve(img.src); img.onerror = reject; });
        try {
            const imgSrc = await imageLoadPromise; const title = video.title || "‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø"; const realContent = document.createElement('div'); realContent.className = 'real-content';
            const thumbnailContainer = document.createElement('div'); thumbnailContainer.className = 'thumbnail-container'; thumbnailContainer.innerHTML = `<img src="${imgSrc}" alt="${title}" loading="lazy"><div class="play-button-overlay"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>`;
            const interactionSection = document.createElement('div'); interactionSection.className = 'interaction-section'; interactionSection.innerHTML = `<h3 class="video-title">${title}</h3><div class="reaction-section"></div>`;
            const reactionSection = interactionSection.querySelector('.reaction-section'); const userReactions = getStoredData('userReactions');
            reactionTypes.forEach(type => { const item = document.createElement('div'); item.className = 'reaction-item'; item.dataset.reactkey = type.key; item.innerHTML = `<button class="react-btn ${userReactions[video.id] === type.key ? 'reacted' : ''}">${type.emoji}</button><div class="reaction-text" style="color:${type.color};">${type.text}</div><div class="reaction-count">(${(video.reactions && video.reactions[type.key]) || 0})</div>`; item.onclick = () => handleReaction(video, type, item); reactionSection.appendChild(item); });
            realContent.append(thumbnailContainer, interactionSection); videoCard.innerHTML = ''; videoCard.appendChild(realContent);
            
            thumbnailContainer.addEventListener('click', () => {
                try {
                    if (activePlayer) { cleanUpCurrentPlayer(); }
                    thumbnailContainer.innerHTML = `<div class="video-loading-spinner"><div class="spinner"></div></div>`;
                    const playerDivId = `player-${video.id}`;
                    const playerDiv = document.createElement('div');
                    playerDiv.id = playerDivId;

                    players[playerDivId] = new YT.Player(playerDiv, { 
                        videoId: videoId, playerVars: { 'autoplay': 1, 'rel': 0 }, 
                        events: { 
                            'onReady': (event) => {
                                thumbnailContainer.innerHTML = '';
                                thumbnailContainer.appendChild(event.target.getIframe());
                            },
                            'onStateChange': onPlayerStateChange 
                        } 
                    });
                } catch(e) { console.error("YouTube Player ‡¶§‡ßà‡¶∞‡¶ø‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e); thumbnailContainer.innerHTML = '<p style="color:red; text-align:center; padding:1rem;">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§</p>'; }
            }, { once: true });
            videoCard.classList.remove('is-loading');
        } catch (error) { console.error('‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:', videoId, error); videoCard.remove(); }
    }

    function loadMoreVideos(){if(isLoading)return;isLoading=!0,loadingSpinner.style.display="block";const e=videosDisplayedCount,t=e+videosPerLoad,o=videosToDisplayList.slice(e,t);if(0===o.length)return isLoading=!1,void(loadingSpinner.style.display="none");o.forEach(e=>createVideoCard(e)),videosDisplayedCount+=o.length,isLoading=!1,loadingSpinner.style.display="none"}
    
    function setupCategoryView(category, isRefresh = false) {
        currentCategory = category;
        mainGrid.innerHTML = "";
        players = {};
        videosDisplayedCount = 0;
        sectionTitle.innerText = categoryInfo[category] || "‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∏‡¶Æ‡ßÇ‡¶π";

        let sourceVideos = (category === 'All') 
            ? allVideosData 
            : allVideosData.filter(video => video.category === category);

        if (sourceVideos.length === 0) {
            mainGrid.innerHTML = `<p class="empty-category-message">‡¶è‡¶á ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>`;
            return;
        }

        const shuffleArray = arr => arr.slice().sort(() => Math.random() - 0.5);

        if (isRefresh) {
            videosToDisplayList = shuffleArray(sourceVideos);
        } else {
            const newVideos = allVideosData.slice(0, Math.floor(allVideosData.length * 0.2));
            const reactedVideos = [...allVideosData].sort((a, b) => {
                const reactionsA = Object.values(a.reactions || {}).reduce((sum, count) => sum + count, 0);
                const reactionsB = Object.values(b.reactions || {}).reduce((sum, count) => sum + count, 0);
                return reactionsB - reactionsA;
            });

            let finalList = []; let usedIds = new Set();
            const addVideos = (pool) => {
                for (const video of pool) {
                    if ((category === 'All' || video.category === category) && !usedIds.has(video.id)) {
                        finalList.push(video); usedIds.add(video.id);
                    }
                }
            };
            addVideos(shuffleArray(sourceVideos));
            videosToDisplayList = finalList;
        }
        loadMoreVideos();
    }
    
    // --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ---
    function handleFloatingPlayer() {
        if (!activePlayer || !originalPlayerContainer) return;
        const rect = originalPlayerContainer.getBoundingClientRect();
        const isVisible = (rect.top < window.innerHeight && rect.bottom > 0);

        if (!isVisible && !floatingPlayerContainer.classList.contains('visible')) {
            floatingPlayerContent.appendChild(activePlayer.getIframe());
            floatingPlayerContainer.classList.add('visible');
            if(!originalPlayerContainer.querySelector('.thumbnail-placeholder')) {
               originalPlayerContainer.innerHTML = `<div class="thumbnail-placeholder">‚ñ∂Ô∏è ‡¶è‡¶ñ‡¶® ‡¶ö‡¶≤‡¶õ‡ßá...</div>`;
            }
        } else if (isVisible && floatingPlayerContainer.classList.contains('visible')) {
            originalPlayerContainer.innerHTML = '';
            originalPlayerContainer.appendChild(activePlayer.getIframe());
            floatingPlayerContainer.classList.remove('visible');
        }
    }

    function cleanUpCurrentPlayer() {
        if (activePlayer && typeof activePlayer.stopVideo === 'function') {
            activePlayer.stopVideo();
            const playerIframe = activePlayer.getIframe();
            if (playerIframe && playerIframe.parentElement === floatingPlayerContent) {
                floatingPlayerContainer.classList.remove('visible');
                floatingPlayerContent.innerHTML = '';
            }
        }
        if (originalPlayerContainer && !originalPlayerContainer.querySelector('iframe')) {
           originalPlayerContainer.innerHTML = ''; 
        }
        activePlayer = null;
        originalPlayerContainer = null;
    }

    window.addEventListener("scroll",()=>{
        if(videosDisplayedCount < videosToDisplayList.length && window.innerHeight + window.scrollY >= document.body.offsetHeight - 500){
            loadMoreVideos();
        }
        handleFloatingPlayer();
    });

    navMenu.addEventListener("click",e=>{if(e.target.tagName==="A"&&e.target.dataset.category){e.preventDefault();cleanUpCurrentPlayer();setupCategoryView(e.target.dataset.category);if(navMenu.classList.contains("nav-open"))navMenu.classList.remove("nav-open")}});
    refreshButton.addEventListener("click", () => {
        cleanUpCurrentPlayer();
        setupCategoryView(currentCategory, true);
    });
    floatingPlayerCloseBtn.addEventListener('click', cleanUpCurrentPlayer);
    // --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑ ---

    function onYouTubeIframeAPIReady(){db.ref("videos").once("value",e=>{allVideosData=[],e.exists()&&e.forEach(e=>{allVideosData.push({id:e.key,...e.val()})}),allVideosData.reverse(),setupCategoryView(currentCategory)})}
    const titleElement=document.getElementById("animated-title"),textToType="DeenFlix",typingSpeed=150,eraseSpeed=100,pauseDuration=2e3;let charIndex=0;function type(){charIndex<textToType.length?(titleElement.textContent+=textToType.charAt(charIndex++),setTimeout(type,typingSpeed)):setTimeout(erase,pauseDuration)}function erase(){charIndex>0?(titleElement.textContent=textToType.substring(0,--charIndex),setTimeout(erase,eraseSpeed)):setTimeout(type,typingSpeed)}const themeToggle=document.getElementById("theme-toggle"),body=document.body,savedTheme=localStorage.getItem("theme");"dark"===savedTheme&&body.classList.add("dark-mode"),themeToggle.addEventListener("click",()=>{body.classList.toggle("dark-mode"),localStorage.setItem("theme",body.classList.contains("dark-mode")?"dark":"light")});const menuIcon=document.getElementById("menu-icon");menuIcon.addEventListener("click",()=>navMenu.classList.toggle("nav-open")),document.addEventListener("click",function(e){const t=navMenu.contains(e.target),o=menuIcon.contains(e.target);navMenu.classList.contains("nav-open")&&!t&&!o&&navMenu.classList.remove("nav-open")}),document.addEventListener("DOMContentLoaded",type);
  </script>
</body>
</html>
